---
title: JS：我有特别的输出banana技巧
date: 2019-09-20 21:26:15
tags: [JavaScript,前端]
---

今天之前一个关系不错的同事发来一段很有意思的js代码，代码如下

```JavaScript
('b' + 'a' + + 'a' + 'a').toLowerCase()
```

这段代码的输出为`banana`。

大家都知道js的一些语法和规则都比较怪异，这段代码也不例外，那为什么这段代码会输出这样的结果呢？
这就与JavaScript运算符优先级相关了，我们先了解一下这段代码涉及到的运算符及其优先级，如下：

优先级 | 运算类型 | 关联性 | 运算符
:-: | :-: | :-: | :-: 
20 | 圆括号 | n/a | (...) 
16 | 一元正号 | 从右至左 | + ... 
13 | 加法 | 从左至右 | ... + ...

OK，了解了上面的运算符优先级之后，我们来分析一下上面那段代码。

首先`('b' + 'a' + + 'a' + 'a')` ，按照运算符优先级分解一下运算步骤，
从上面优先级的表格我们可以看到圆括号的优先级最高，其次是一元正号（有人可能不太明白什么是一元正号，这里解释一下一元正号 `+` ，大家都知道一元负号 `-` ，比如说一个正数 `2` 前面加上一元负号运算符，就会变成负数 `-2` ，那么加上一元正号呢？变为 `+2` ，其实还是正数 `2`。一元正号，其实就是我们初中学正负数时候的正数前面省略的 `+` ）


此段代码中运算优先级最低的就是加法运算，所以按照运算符优先级，代码可以转换成这个样子

```JavaScript
'b' + 'a' + (+ 'a') + 'a' //因为一元正号的优先级比加法高，所以用括号标注一下
```

那么就会先运算 `(+ 'a')`

我们来看一下一元正号的说明：
```
一元正号运算符位于其操作数前面，计算其操作数的数值，如果操作数不是一个数值，会尝试将其转换成一个数值。 尽管一元负号也能转换非数值类型，但是一元正号是转换其他对象到数值的最快方法，也是最推荐的做法，因为它不会对数值执行任何多余操作。它可以将字符串转换成整数和浮点数形式，也可以转换非字符串值 true，false 和 null。小数和十六进制格式字符串也可以转换成数值。负数形式字符串也可以转换成数值（对于十六进制不适用）。如果它不能解析一个值，则计算结果为 NaN。
```

请注意看这段话：`如果操作数不是一个数值，会尝试将其转换成一个数值和如果它不能解析一个值，则计算结果为 NaN`

那么`(+ 'a')`就会是变成 `NaN`，然后又涉及到了隐式转化，加号在JavaScript规则里有一条是，当操作符有一个是字符串类型时，另一个也要转成字符串类型。也就是说 `NaN` 要进行`toString`，然后原代码执行过程如下:

```JavaScript
'b' + 'a' + (+ 'a') + 'a'
// to
'b' + 'a' + Number('a') + 'a'
// to
'b' + 'a' + NaN + 'a'
//to
'b' + 'a' + 'NaN' + 'a'
```

最终再调用 `toLowerCase()` 将其转换为小写，就变成了 `banana`