---
title: Java并发编程（一）之并发编程基础知识
date: 2019-11-13 21:02:52
tags: [多线程,并发,Java]
---

并发编程是每一个软件工程师（不要再叫自己程序员了，我们是软件工程师）都需要学习的知识，对于一个优秀的软件工程师来说，掌握好并发编程是一门必修课。所以，为了成为一名优秀的软件工程师，我在半年多以前就开始学习并发编程的知识，但是因为后来工作的原因，这个学习计划就被搁置了，今天再次回顾以前学习的知识，发现大部分都被我忘记了，因为工作中用到并发编程的知识实在是少。做Java后端开发的同学也应该深有体会，大部分工作只是业务逻辑的curd，一些同行也戏称自己是“curd boy”。今天再次拾起并发编程的知识，也在此做个笔记，分享一下，有理解的不正确的还请大家指正，共同学习，也为自己加深一遍印象，让自己忘得慢一些，也方便以后复习的时候再去慢慢翻书，直接看笔记就好，会省下很多时间。

要学习并发编程，首先我们要了解，什么是并发编程？

提起并发编程很多人会混乱并发与并行两个概念，所以首先要澄清并发与并行的概念与区别。

```
并发是指同一个时间段内多个任务同时都在执行，而并行是说在单位时间内多个任务同时执行。
```

看起来很迷惑对不对，什么叫同一个时间段，什么叫单位时间？通俗的来说，一个时间段有多个单位时间累积而成，并发就是多个任务在这个时间段内执行，但不一定在同一个单位时间执行。而并行则是多个任务在同一个单位时间同时执行。

举个例子：

就拿人吃饭来说，一般大家吃饭的时候都会有再配一碗汤，我们可以把吃饭看做两个任务，一个是吃馒头，一个是喝汤，吃一口馒头是一个单位时间，喝一口汤也是一个单位时间，吃饭花费的时间就是一个时间段，而我们的嘴，是用来执行吃饭任务的，也就是一个CPU。一般我们吃饭的时候都是吃两口馒头，喝一口汤，在单个CPU的情况下（也就是我们只有一个嘴的情况下），吃馒头和喝汤是交替执行的，不可能在吃馒头的同时再喝一口汤，这就是并发，两个任务吃馒头喝汤，在同一个时间段内执行，但不一定是同一个单位时间执行。那么什么是并行呢，假设有人长了两张嘴，在吃饭的时候，一张嘴吃馒头的同时，另一张嘴喝汤，在同一个单位时间，执行两个或者多个任务，这就是并行。

在单CPU时代，多个任务是共享一个CPU的，当一个任务占用CPU时，其他任务就会被挂起不能执行，当占用CPU的任务时间片用完后，才会把CPU让给其他任务使用，也就是，当我们吃馒头的时候，嘴正在被占用着，喝汤这个任务就没法占用我们的嘴，只有当咬下这一口馒头，才会把嘴的使用权交给喝汤这个任务。

在单CPU时代，多线程编程是没有太大意义的，因为CPU只有一个，每个线程都只能交替使用这一个CPU，这样会导致线程间频繁的上下文切换，这也会带来额外的开销。就好比我们吃饭的时候，咬一口馒头咽下去，再伸手拿汤递到嘴边喝一口，再咬一口馒头咽下去，再把汤递到嘴边喝一口，这样的方式显然没有我们一开始就只吃馒头，吃完馒头，再端起汤来一口一口喝掉来的省时间。

如果为双CPU配置，线程A和线程B各自在自己的cpu上执行任务，那就真正的实现了并行运行。但在多线程编程实践中，线程的个数往往多余CPU的个数，所以一般都称多线程并发编程而不多线程并行编程。

到如今，连个人电脑都不止单个CPU了，一般的服务器的CPU个数几乎都能达到几十个，这打破了单个CPU对多线程编程效能的限制，多个CPU意味着每个线程都可以使用自己的CPU运行，这减少了线程上下文切换的开销，但随着对应用系统性能和吞吐量要求的提高，出现了处理海量数据和请求的要求，这些都对高并发编程有着迫切的需求。

